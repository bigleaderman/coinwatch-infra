.PHONY: all brew kubectl minikube docker helm kafka start status

# ì „ì²´ ì„¤ì¹˜ ìˆœì„œ ì‹¤í–‰
all: brew kubectl minikube docker helm start kafka status

# Homebrew ì„¤ì¹˜
brew:
	@echo "ğŸ”§ Installing Homebrew..."
	/bin/bash -c "$$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
	@echo 'âœ… Homebrew installation complete.'

# kubectl ì„¤ì¹˜
kubectl:
	@echo "ğŸ”§ Installing kubectl..."
	brew install kubectl
	kubectl version --client
	@echo 'âœ… kubectl installation complete.'

# minikube ì„¤ì¹˜
minikube:
	@echo "ğŸ”§ Installing Minikube..."
	brew install minikube
	minikube version
	@echo 'âœ… Minikube installation complete.'

# Docker Desktop 4.26.1 ì„¤ì¹˜
docker:
	@echo "ğŸ”§ Installing Docker Desktop version 4.26.1..."
	brew install --cask homebrew/cask-versions/docker@4.26.1
	@echo 'âš ï¸  Please manually launch Docker Desktop and ensure it is running.'

# Helm ì„¤ì¹˜
helm:
	@echo "ğŸ”§ Installing Helm..."
	brew install helm
	helm version
	@echo 'âœ… Helm installation complete.'

# Minikube í´ëŸ¬ìŠ¤í„° ì‹œì‘
start:
	@echo "ğŸš€ Starting Minikube with Docker driver..."
	minikube start --driver=docker --cpus=4 --memory=4g

# Kafka ì„¤ì¹˜ (Bitnami ì°¨íŠ¸ + ìµœì†Œ ì„¤ì •)
kafka:
	@echo "ğŸ“¦ Installing Kafka via Helm (Bitnami, lightweight config)..."
	helm repo add bitnami https://charts.bitnami.com/bitnami
	helm repo update
	helm upgrade --install my-kafka bitnami/kafka --namespace kafka --create-namespace \
	  --set replicaCount=1 \
	  --set resources.requests.cpu=250m \
	  --set resources.requests.memory=512Mi \
	  --set resources.limits.cpu=500m \
	  --set resources.limits.memory=1Gi \
	  --set zookeeper.replicaCount=1 \
	  --set zookeeper.resources.requests.memory=256Mi \
	  --set zookeeper.resources.limits.memory=512Mi
	@echo 'âœ… Kafka installed in namespace "kafka".'

# í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
status:
	@echo "ğŸ” Checking Minikube status..."
	minikube status
	kubectl get pods -A

